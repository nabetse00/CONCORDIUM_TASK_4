import{j as e,u as L,a as K}from"./index-5c482bb5.js";import{r as o,e as S}from"./wallet-0d6fe0b8.js";import{B as N,q as H,s as $,T as Y,u as x,g as P,S as M,c as G,v as U,I as W,w as J,x as V,y as Q}from"./ui-bc4a4294.js";import{N as X}from"./NoAccount-4f90af33.js";import{a as Z,g as ee,i as te,u as ne}from"./invokeContractFn-b1242018.js";import{e as oe,f as se,g as ae,h as re}from"./icons-ffceca67.js";import"./contract-8d575f94.js";function ce(t){const[s,c]=o.useState(!1),w=()=>{c(!0)},d=()=>{t.confirm(),c(!1)},n=()=>{t.cancel(),c(!1)};return o.useEffect(()=>{t.showConfirmModal?c(!0):c(!1)},[t.showConfirmModal]),e.jsxs(e.Fragment,{children:[t.showButton&&e.jsx(N,{type:"primary",onClick:w,children:"Open Modal"}),e.jsx(H,{title:t.title,okText:"Confirm",cancelText:"Cancel",open:s,onOk:d,onCancel:n,children:t.content})]})}const{Panel:ie}=$;function ue(t){const[s,c]=o.useState(!0),[w,d]=o.useState(!1),[n,h]=o.useState([{label:new Date(Date.now()).toLocaleString(),children:`Transaction [${t.hash}] sent`,color:"red"}]),f=t.timeoutMilisec?t.timeoutMilisec:500;function g(i){if(i){if(n.length>0&&n[n.length-1].children!==i.children){h(u=>[...u,i]);return}if(n.length==0){h(u=>[...u,i]);return}if(n.length>0&&n[n.length-1].children===i.children){h([...n]);return}}}function T(i){if(i){const u=new Date(Date.now()).toLocaleString();let r,m,l;switch(i.status.toString()){case S.TransactionStatusEnum.Committed:r="Transaction committed",m=e.jsx(re,{}),l="grey";break;case S.TransactionStatusEnum.Received:r="Transaction recieved",l="blue",m=e.jsx(ae,{});break;case S.TransactionStatusEnum.Finalized:console.log("from txn Status finish"),r="Transaction Finalized",l="green",m=e.jsx(se,{});break;default:console.log("from txn Status ????"),r="Transaction is `unknown` possible error",l="red",m=e.jsx(oe,{});break}return{label:u,children:r,dot:m,color:l}}}return o.useEffect(()=>{let i,u;return w||Z(t.connection,t.hash).then(r=>{u=r,r&&r.status===S.TransactionStatusEnum.Finalized&&(g(T(u)),c(!1),d(!0),t.callback()),c(!1),r&&r.status!==S.TransactionStatusEnum.Finalized&&c(!0)}).catch(r=>{console.error(r),c(!1)}),s&&(i=setTimeout(()=>g(T(u)),f)),()=>{clearTimeout(i)}},[t,n,s]),e.jsx($,{defaultActiveKey:["1"],children:e.jsx(ie,{header:"Transaction status",children:e.jsx(Y,{mode:"left",items:n,pending:s})},1)})}const{Text:p,Link:je}=Q,{Option:F}=V;function ve(){const{connection:t,account:s,network:c}=L();o.useState();const[w,d]=o.useState(""),[n,h]=o.useState(),[f,g]=o.useState(),[T,i]=o.useState(""),[u,r]=o.useState(0),[m,l]=o.useState(!1),[y,b]=o.useState(!1),[I,E]=o.useState(),B=K();o.useEffect(()=>{(!t||!s)&&(console.log("redirect"),B("/CONCORDIUM_TASK_4/")),t&&s&&!y&&(ee(t).then(a=>{g(a),i("")}).catch(a=>{g(void 0),i(a)}),te(t).then(a=>{h(a),d("")}).catch(a=>{console.log(a),h(void 0),d(a)}))},[t,s,y,I]);function q(a){if(t&&s){b(!0);let C=new Date(Date.now());const A=`new richest ${C.toLocaleDateString()} Time ${C.toLocaleTimeString()} `;ne(t,s,a,A).then(v=>{E(v)}).catch(v=>{console.error(v),E(void 0),b(!1)})}else console.error(new Error("Not Connected to wallet"))}function z(){b(!1)}function R(a){l(!0);let C=a.amount.value;a.amount.currency==="ccd"&&(C*=1e6),r(C)}const[j]=x.useForm(),_={amount:{currency:"ccd",value:0,validated:!1}};return e.jsx(o.Suspense,{fallback:e.jsx(P,{}),children:n&&f&&s?e.jsxs(M,{direction:"vertical",size:"middle",children:[e.jsx(G,{message:"Become the Richest",description:e.jsxs(M,{direction:"vertical",children:[e.jsx(p,{children:s===n.richest_account.Some[0]?`You are the richest with ${Number(f.amount.microCcdAmount)/1e6} CCD in contract`:`${n.richest_account.Some[0]} is the richest with ${Number(f.amount.microCcdAmount)/1e6} CCD in contract. Add ${n.minimum_raise} to become the richest !`}),e.jsx(p,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"})]}),type:"info",showIcon:!0}),t&&I&&e.jsx(ue,{hash:I,connection:t,callback:z}),e.jsx(ce,{content:le(j.getFieldValue(["amount","value"]),j.getFieldValue(["amount","currency"])),confirm:()=>{l(!1),q(u)},cancel:()=>{l(!1)},title:"Become the richest",showConfirmModal:m}),e.jsx(U,{children:e.jsxs(x,{form:j,layout:"vertical",onFinish:R,size:"large",colon:!0,initialValues:_,title:"Amount to become the richest",requiredMark:!0,style:{maxWidth:600},children:[e.jsx(x.Item,{name:["amount","validated"],label:"Amount",dependencies:[["amount","currency"],["amount","value"]],rules:[({getFieldValue:a})=>({validator(C,A){const v=a(["amount","currency"]),D=a(["amount","value"]),k=Number(n.minimum_raise)+Number(f.amount.microCcdAmount)/1e6;switch(v){case"microCcd":const O=k*1e6;return D>O?(j.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${O} microCcd @ 1 cent per CCD`));case"ccd":return D>k?(j.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${k} Ccd @ 1 cent per CCD`));default:return Promise.reject(new Error("Input correct amount and currency"))}}})],children:e.jsxs(W.Group,{compact:!0,children:[e.jsx(x.Item,{name:["amount","value"],dependencies:[["amount","currency"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Value is required"}],children:e.jsx(J,{style:{width:"50%"},placeholder:"Enter Ammount"})}),e.jsx(x.Item,{name:["amount","currency"],dependencies:[["amount","value"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Currency is required",validateTrigger:"onChange"}],children:e.jsxs(V,{style:{width:100},children:[e.jsx(F,{value:"ccd",children:"CCD"}),e.jsx(F,{value:"microCcd",children:"Î¼CCD"})]})})]})}),e.jsx(x.Item,{children:e.jsx(N,{type:"primary",htmlType:"submit",children:"Pay to become the richest!"})})]})})]}):s?e.jsx(P,{}):e.jsx(X,{network:c==null?void 0:c.name})})}function le(t,s){return e.jsxs(M,{direction:"vertical",children:[e.jsx(p,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"}),e.jsxs(p,{type:"danger",children:["You are about to spend ",t," ",s," to become the richest is it OK?"]})]})}export{ve as BecomeTheRichestPage};

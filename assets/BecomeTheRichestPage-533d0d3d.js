import{u as q,a as B,j as e}from"./index-7a162a28.js";import{r as n}from"./wallet-05f4693c.js";import{T as F,M as R}from"./txnStatusComp-4c5b1306.js";import{N as L}from"./NoAccount-0b3f5844.js";import{g as z,a as H,u as K}from"./invokeContractFn-42342478.js";import{q as a,g as I,S as v,c as Y,s as G,I as U,u as W,v as M,B as J,T as Q}from"./ui-39a4cd14.js";import"./icons-dea615b7.js";const{Text:l,Link:ie}=Q,{Option:E}=M;function ue(){const{connection:r,account:o,network:d}=q();n.useState();const[Z,f]=n.useState(""),[c,j]=n.useState(),[m,g]=n.useState(),[ee,S]=n.useState(""),[k,D]=n.useState(0),[N,h]=n.useState(!1),[y,p]=n.useState(!1),[C,w]=n.useState(),O=B();n.useEffect(()=>{(!r||!o)&&(console.log("redirect"),O("/CONCORDIUM_TASK_4/")),r&&o&&!y&&(z(r).then(t=>{g(t),S("")}).catch(t=>{g(void 0),S(t)}),H(r).then(t=>{j(t),f("")}).catch(t=>{console.log(t),j(void 0),f(t)}))},[r,o,y,C]);function P(t){if(r&&o){p(!0);let s=new Date(Date.now());const b=`new richest ${s.toLocaleDateString()} Time ${s.toLocaleTimeString()} `;K(r,o,t,b).then(u=>{w(u)}).catch(u=>{console.error(u),w(void 0),p(!1)})}else console.error(new Error("Not Connected to wallet"))}function _(){p(!1)}function V(t){h(!0);let s=t.amount.value;t.amount.currency==="ccd"&&(s*=1e6),D(s)}const[i]=a.useForm(),$={amount:{currency:"ccd",value:0,validated:!1}};return e.jsx(n.Suspense,{fallback:e.jsx(I,{}),children:c&&m&&o?e.jsxs(v,{direction:"vertical",size:"middle",children:[e.jsx(Y,{message:"Become the Richest",description:e.jsxs(v,{direction:"vertical",children:[e.jsx(l,{children:o===c.richest_account.Some[0]?`You are the richest with ${Number(m.amount.microCcdAmount)/1e6} CCD in contract`:`${c.richest_account.Some[0]} is the richest with ${Number(m.amount.microCcdAmount)/1e6} CCD in contract. Add ${c.minimum_raise} to become the richest !`}),e.jsx(l,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"})]}),type:"info",showIcon:!0}),r&&C&&e.jsx(F,{hash:C,connection:r,callback:_}),e.jsx(R,{content:X(i.getFieldValue(["amount","value"]),i.getFieldValue(["amount","currency"])),confirm:()=>{h(!1),P(k)},cancel:()=>{h(!1)},title:"Become the richest",showConfirmModal:N}),e.jsx(G,{children:e.jsxs(a,{form:i,layout:"vertical",onFinish:V,size:"large",colon:!0,initialValues:$,title:"Amount to become the richest",requiredMark:!0,style:{maxWidth:600},children:[e.jsx(a.Item,{name:["amount","validated"],label:"Amount",dependencies:[["amount","currency"],["amount","value"]],rules:[({getFieldValue:t})=>({validator(s,b){const u=t(["amount","currency"]),A=t(["amount","value"]),x=Number(c.minimum_raise)+Number(m.amount.microCcdAmount)/1e6;switch(u){case"microCcd":const T=x*1e6;return A>T?(i.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${T} microCcd @ 1 cent per CCD`));case"ccd":return A>x?(i.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${x} Ccd @ 1 cent per CCD`));default:return Promise.reject(new Error("Input correct amount and currency"))}}})],children:e.jsxs(U.Group,{compact:!0,children:[e.jsx(a.Item,{name:["amount","value"],dependencies:[["amount","currency"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Value is required"}],children:e.jsx(W,{style:{width:"50%"},placeholder:"Enter Ammount"})}),e.jsx(a.Item,{name:["amount","currency"],dependencies:[["amount","value"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Currency is required",validateTrigger:"onChange"}],children:e.jsxs(M,{style:{width:100},children:[e.jsx(E,{value:"ccd",children:"CCD"}),e.jsx(E,{value:"microCcd",children:"Î¼CCD"})]})})]})}),e.jsx(a.Item,{children:e.jsx(J,{type:"primary",htmlType:"submit",children:"Pay to become the richest!"})})]})})]}):o?e.jsx(I,{}):e.jsx(L,{network:d==null?void 0:d.name})})}function X(r,o){return e.jsxs(v,{direction:"vertical",children:[e.jsx(l,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"}),e.jsxs(l,{type:"danger",children:["You are about to spend ",r," ",o," to become the richest is it OK?"]})]})}export{ue as BecomeTheRichestPage};

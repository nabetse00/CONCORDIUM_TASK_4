import{j as e,u as q,a as R}from"./index-4fbfe48d.js";import{r as o}from"./wallet-05f4693c.js";import{B as E,w as z,x as i,g as I,S as v,c as L,q as H,y as K,I as Y,z as O,E as G}from"./ui-276e3024.js";import{N as U}from"./NoAccount-9ba73a6f.js";import{T as W}from"./txnStatusComp-58361c22.js";import{a as J,b as Q,u as X}from"./invokeContractFn-022ec71d.js";import"./icons-b790460c.js";function Z(t){const[r,a]=o.useState(!1),j=()=>{a(!0)},m=()=>{t.confirm(),a(!1)},c=()=>{t.cancel(),a(!1)};return o.useEffect(()=>{t.showConfirmModal?a(!0):a(!1)},[t.showConfirmModal]),e.jsxs(e.Fragment,{children:[t.showButton&&e.jsx(E,{type:"primary",onClick:j,children:"Open Modal"}),e.jsx(z,{title:t.title,okText:"Confirm",cancelText:"Cancel",open:r,onOk:m,onCancel:c,children:t.content})]})}const{Text:h,Link:ue}=G,{Option:k}=O;function le(){const{connection:t,account:r,network:a}=q();o.useState();const[j,m]=o.useState(""),[c,w]=o.useState(),[d,y]=o.useState(),[te,g]=o.useState(""),[D,N]=o.useState(0),[P,f]=o.useState(!1),[S,C]=o.useState(!1),[x,b]=o.useState(),_=R();o.useEffect(()=>{(!t||!r)&&(console.log("redirect"),_("/CONCORDIUM_TASK_4/")),t&&r&&!S&&(J(t).then(n=>{y(n),g("")}).catch(n=>{y(void 0),g(n)}),Q(t).then(n=>{w(n),m("")}).catch(n=>{console.log(n),w(void 0),m(n)}))},[t,r,S,x]);function V(n){if(t&&r){C(!0);let s=new Date(Date.now());const M=`new richest ${s.toLocaleDateString()} Time ${s.toLocaleTimeString()} `;X(t,r,n,M).then(l=>{b(l)}).catch(l=>{console.error(l),b(void 0),C(!1)})}else console.error(new Error("Not Connected to wallet"))}function $(){C(!1)}function B(n){f(!0);let s=n.amount.value;n.amount.currency==="ccd"&&(s*=1e6),N(s)}const[u]=i.useForm(),F={amount:{currency:"ccd",value:0,validated:!1}};return e.jsx(o.Suspense,{fallback:e.jsx(I,{}),children:c&&d&&r?e.jsxs(v,{direction:"vertical",size:"middle",children:[e.jsx(L,{message:"Become the Richest",description:e.jsxs(v,{direction:"vertical",children:[e.jsx(h,{children:r===c.richest_account.Some[0]?`You are the richest with ${Number(d.amount.microCcdAmount)/1e6} CCD in contract`:`${c.richest_account.Some[0]} is the richest with ${Number(d.amount.microCcdAmount)/1e6} CCD in contract. Add ${c.minimum_raise} to become the richest !`}),e.jsx(h,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"})]}),type:"info",showIcon:!0}),t&&x&&e.jsx(W,{hash:x,connection:t,callback:$}),e.jsx(Z,{content:ee(u.getFieldValue(["amount","value"]),u.getFieldValue(["amount","currency"])),confirm:()=>{f(!1),V(D)},cancel:()=>{f(!1)},title:"Become the richest",showConfirmModal:P}),e.jsx(H,{children:e.jsxs(i,{form:u,layout:"vertical",onFinish:B,size:"large",colon:!0,initialValues:F,title:"Amount to become the richest",requiredMark:!0,style:{maxWidth:600},children:[e.jsx(i.Item,{name:["amount","validated"],label:"Amount",dependencies:[["amount","currency"],["amount","value"]],rules:[({getFieldValue:n})=>({validator(s,M){const l=n(["amount","currency"]),A=n(["amount","value"]),p=Number(c.minimum_raise)+Number(d.amount.microCcdAmount)/1e6;switch(l){case"microCcd":const T=p*1e6;return A>T?(u.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${T} microCcd @ 1 cent per CCD`));case"ccd":return A>p?(u.setFieldsValue({amount:{validated:!0}}),Promise.resolve("microCdd Amount Ok")):Promise.reject(new Error(`Must be greater than ${p} Ccd @ 1 cent per CCD`));default:return Promise.reject(new Error("Input correct amount and currency"))}}})],children:e.jsxs(K.Group,{compact:!0,children:[e.jsx(i.Item,{name:["amount","value"],dependencies:[["amount","currency"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Value is required"}],children:e.jsx(Y,{style:{width:"50%"},placeholder:"Enter Ammount"})}),e.jsx(i.Item,{name:["amount","currency"],dependencies:[["amount","value"],["amount","validation"]],noStyle:!0,rules:[{required:!0,message:"Currency is required",validateTrigger:"onChange"}],children:e.jsxs(O,{style:{width:100},children:[e.jsx(k,{value:"ccd",children:"CCD"}),e.jsx(k,{value:"microCcd",children:"Î¼CCD"})]})})]})}),e.jsx(i.Item,{children:e.jsx(E,{type:"primary",htmlType:"submit",children:"Pay to become the richest!"})})]})})]}):r?e.jsx(I,{}):e.jsx(U,{network:a==null?void 0:a.name})})}function ee(t,r){return e.jsxs(v,{direction:"vertical",children:[e.jsx(h,{children:"Please don't pay insane amounts so other user can test this contract without spending too much!"}),e.jsxs(h,{type:"danger",children:["You are about to spend ",t," ",r," to become the richest is it OK?"]})]})}export{le as BecomeTheRichestPage};
